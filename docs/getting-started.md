 # Getting Started

- Install [JDK 8+](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html)
  - If you're using a JetBrains IDE, you can use JRE shipped with it directly. See [IDE Integration](./ide.md)
- Copy `gradle` directory/`gradlew` file/`gradlew.bat` file in **this project** to **the golang project to be built**
- Create a file named `build.gradle` in **the golang project to be built** with the following content:

```groovy
plugins {
    id 'com.github.blindpirate.gogradle' version '0.4.2'
}

golang {
    packagePath = 'github.com/your/package' // go import path of project to be built, NOT local file system path!
}
```

If you are using one of glide/glock/godep/gom/gopm/govendor/gvt/gbvendor/trash, then Gogradle will read the dependency lock file generated by them automatically without any extra configuration. You can generate `gogradle.lock` as its own dependency lock file. Once the file is generated, the original lock file will lose efficacy, and you can delete them. See [Dependency Lock](#dependency-lock) for more details.

## Build a Golang Project

Enter root directory of the project and run:

```
./gradlew build # *nix

gradlew build # Windows
```

Hereinafter, we will use with uniform command form `gradlew <task>` on both `*nix` and `Windows`.

The command is equivalent to `go build` in project root directory with proper `GOPATH`, and Gogradle will do all the stuff such as dependency resolution and installation. Note that Gogradle doesn't touch global `GOPATH` at all, and it will install all the denpendencies into project root directory and set environment variables to proper values automatically - it means that the build will be totally isolated and reproducible.

If your main package is not located in root directory, add following code into your `build.gradle`

```groovy
build {
    doLast {
        go 'build -o ./gogradle/output github.com/my/package/my/subpackage'
    }
}
```

Note the quote is necessary.


## Test a Golang Project

Enter root directory of the project and run:

```
gradlew test
```

If you want to specify some tests:

```
gradlew test --tests main_test.go // Specify a single test
gradlew test --tests *_test.go // Wildcard test
```

If you want to let build depend on test, just add the following line to `build.gradle`:

```groovy
build.dependsOn test
```

Test reports will be generated in `<project root>/.gogradle/reports/test`.

## Add a dependency

To add a dependency package, just add its name and version into `dependencies` block of `build.gradle`:

```groovy
dependencies {
    build 'github.com/a/b@v1.0.0' 
    test 'github.com/c/d#d3fbe10ecf7294331763e5c219bb5aa3a6a86e80'
}
```

The `build` and `test` are two independent dependency sets. Only `build` dependencies will take effect in build process; both `build` and `test` dependencies will take effect in test process.

To learn more details about dependency, see [Dependency Management](./dependency-management.md).

## Display Dependencies

```
gradlew dependencies
```

The output is as follows:

```
build:

github.com/gogits/gogs
├── github.com/Unknwon/cae:c6aac99 √
├── github.com/Unknwon/com:28b053d √
├── github.com/Unknwon/i18n:39d6f27 √
│   ├── github.com/Unknwon/com:28b053d √ (*)
│   └── gopkg.in/ini.v1:766e555 -> 6f66b0e
├── github.com/Unknwon/paginater:701c23f √
├── github.com/bradfitz/gomemcache:2fafb84 √
├── github.com/go-macaron/binding:4892016 √
│   ├── github.com/Unknwon/com:28b053d √ (*)
│   └── gopkg.in/macaron.v1:ddb19a9 √
│       ├── github.com/Unknwon/com:28b053d √ (*)
│       ├── github.com/go-macaron/inject:d8a0b86 -> c5ab7bf
│       └── gopkg.in/ini.v1:766e555 -> 6f66b0e (*)
... 

```

This is denpendency tree of [gogs](https://github.com/gogits/gogs) in v0.9.113. A `glide.lock` file exists in its root directory, thus Gogradle imports it automatically. It's simple, isn't it?

Tick mark `√` indicates that the dependency is the final resolved version; arrow `->` indicates that the dependency conflicts with another dependency and is resolved to another version; star `*` indicates this node's descendants are ignored because they have been displayed before.

## Dependency Lock

```
gradlew lock
```

This command will let Gogradle generate a `gogradle.lock` file in project root directory, which records all dependencies of this project. 

`gogradle.lock` is recommended by Gogradle. Locking dependencies play an important role in reproducible build. Similar to [other package management tools](https://github.com/golang/go/wiki/PackageManagementTools), Gogradle can lock the versions of all dependency packages. Moreover, Gogradle can lock dependency packages even when they are in `vendor`!

Gogradle supports transitive dependency/dependency exclusion/customized url, see [Dependency Management](./dependency-management.md).

Currently, only Git dependencies are supported, support for other vcs is under development.

## Configuration

The following complete configuration is located in `golang` block of `build.gradle`.

```groovy
golang {
    
    // Import path of package to be built
    packagePath = 'github.com/user/project'
    
    // The buid mode. There are two alternatives: DEVELOP/REPRODUCIBLE, DEVELOP by default
    // In DEVELOP mode, the dependency priority is:
    // 1.dependencies declared in build.gradle
    // 2.locked dependencies (in goradle.lock or lock file of other tools)
    // 3.dependencies in vendor directory
    // In REPRODUCIBLE mode, the priority is:
    // 1.dependencies in vendor
    // 2.locked dependencies
    // 3.dependencies declared in build.gradle

    mode = 'REPRODUCIBLE'
    
    // The golang version to use. See https://golang.org/dl/
    // If not specified, the latest stable version is used
    goVersion = '1.7.1'
    
    // Default value is "go". Modify this when go is not in $PATH
    goExecutable = '/path/to/go/executable'
    // If not set, GOROOT will be <directory of go binary>/..
    goRoot = '/path/to/my/goroot'
    
    // aka. build constraint. See https://golang.org/pkg/go/build/#hdr-Build_Constraints
    buildTags = ['appengine','anothertag']
    
    // Additional feature for users in mainland China,
    // ignore it if you are not
    fuckGfw = true
    
    // cache time for global cache, 24 hours by default
    globalCacheFor 24,'hours'
}
```
